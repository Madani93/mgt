<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cari Kata di Repository GitHub</title>
  <script>
    async function searchInRepo() {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token'); // Mendapatkan token dari URL
      const searchWord = urlParams.get('search'); // Mendapatkan kata pencarian dari URL
      const owner = 'Madani93'; // Owner repository
      const repo = 'sru1'; // Nama repository
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/`;

      if (!token || !searchWord) {
        alert('Token dan kata pencarian harus ada di URL sebagai query parameter.');
        return;
      }

      const result = [];
      
      try {
        const response = await fetch(apiUrl, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!response.ok) {
          throw new Error('Gagal mengambil data dari GitHub');
        }

        const files = await response.json();
        
        for (const file of files) {
          if (file.type === 'file') {
            const fileResponse = await fetch(file.download_url);
            const fileContent = await fileResponse.text();

            if (fileContent.includes(searchWord)) {
              result.push({ file: file.path, found: true });
            }
          }
        }

        // Mengubah hasil menjadi JSON
        const jsonResult = JSON.stringify(result, null, 2);
        
        // Output JSON dalam bentuk baru
        const jsonOutput = `data:application/json;charset=utf-8,${encodeURIComponent(jsonResult)}`;
        window.location.href = jsonOutput; // Mengarahkan ke URL dengan output JSON
      } catch (error) {
        console.error('Error:', error);
        alert('Terjadi kesalahan saat mencari.');
      }
    }
  </script>
</head>
<body>
  <h1>Cari Kata di Repository GitHub</h1>
  <p>Masukkan token dan kata pencarian melalui URL sebagai query parameter:</p>
  <pre>Contoh URL: https://Madani93.github.io/sru1/?token=YOUR_GITHUB_TOKEN&search=kata_yang_dicari</pre>
  
  <button onclick="searchInRepo()">Cari Kata</button>

  <h2>Hasil Pencarian:</h2>
  <pre id="result"></pre>
</body>
</html>
