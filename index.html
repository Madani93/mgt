<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit File on GitHub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        textarea {
            width: 80%;
            height: 200px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Edit File on GitHub</h1>

    <form id="fileForm">
        <label for="repo">Repository:</label><br>
        <input type="text" id="repo" placeholder="e.g., username/repo" required><br><br>
        
        <label for="path">File Path:</label><br>
        <input type="text" id="path" placeholder="e.g., path/to/file" required><br><br>
        
        <label for="fileContent">File Content:</label><br>
        <textarea id="fileContent" placeholder="Enter new file content..."></textarea><br>
        
        <button type="button" onclick="updateFile()">Update File on GitHub</button>
    </form>

    <div id="statusMessage"></div>

    <script>
        // Function to get query parameters from the URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function updateFile() {
            const repo = document.getElementById('repo').value.trim();
            const path = document.getElementById('path').value.trim();
            const content = document.getElementById('fileContent').value.trim();
            const token = getQueryParam('token'); // Get token from URL

            if (!repo || !path || !content || !token) {
                document.getElementById('statusMessage').innerHTML = 'All fields and token are required!';
                return;
            }

            const [owner, repoName] = repo.split('/');
            if (!owner || !repoName) {
                document.getElementById('statusMessage').innerHTML = 'Invalid repository format. Use username/repo.';
                return;
            }

            const encodedContent = btoa(content);  // Encode content to base64

            try {
                // Get the SHA of the existing file
                const shaResponse = await fetch(`https://api.github.com/repos/${owner}/${repoName}/contents/${path}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });

                if (!shaResponse.ok) {
                    throw new Error('File not found or invalid credentials.');
                }

                const shaData = await shaResponse.json();
                const sha = shaData.sha;

                // Update the file
                const response = await fetch(`https://api.github.com/repos/${owner}/${repoName}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update file via GitHub Pages',
                        content: encodedContent,
                        sha: sha
                    })
                });

                if (response.ok) {
                    document.getElementById('statusMessage').innerHTML = 'File updated successfully!';
                } else {
                    const errorData = await response.json();
                    document.getElementById('statusMessage').innerHTML = `Error: ${errorData.message}`;
                }
            } catch (error) {
                document.getElementById('statusMessage').innerHTML = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
